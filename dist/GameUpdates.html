<!DOCTYPE HTML>
<html><head><meta charset="UTF-8"><title>GameUpdates</title><script type="text/javascript" src="/usr/local/share/elm/compiler/elm-runtime.js"></script><script type="text/javascript">Elm.GameUpdates = Elm.GameUpdates || {};
Elm.GameUpdates.make = function (_elm) {
   "use strict";
   _elm.GameUpdates = _elm.GameUpdates || {};
   if (_elm.GameUpdates.values)
   return _elm.GameUpdates.values;
   var _op = {},
   _N = Elm.Native,
   _U = _N.Utils.make(_elm),
   _L = _N.List.make(_elm),
   _A = _N.Array.make(_elm),
   _E = _N.Error.make(_elm),
   $moduleName = "GameUpdates",
   $Basics = Elm.Basics.make(_elm),
   $GameDraw = Elm.GameDraw.make(_elm),
   $GameEnemies = Elm.GameEnemies.make(_elm),
   $GameInput = Elm.GameInput.make(_elm),
   $GameModel = Elm.GameModel.make(_elm),
   $List = Elm.List.make(_elm),
   $Pseudorandom = Elm.Pseudorandom.make(_elm),
   $Time = Elm.Time.make(_elm);
   var stepUI = F3(function (t,
   player,
   ui) {
      return ui;
   });
   var stepSpawnCooldown = F3(function (t,
   score,
   spawnCooldown) {
      return _U.cmp(spawnCooldown,
      0) < 1 ? 1 : spawnCooldown - t;
   });
   var addScoreForKill = F2(function (enemy,
   acc) {
      return enemy.kill ? acc + 100 : acc;
   });
   var stepScore = F3(function (t,
   enemies,
   score) {
      return A3($List.foldl,
      addScoreForKill,
      score,
      enemies);
   });
   var fireEnemyBullets = F2(function (t,
   _v0) {
      return function () {
         return _U.eq(_v0.gun.timeSince,
         0) ? $GameModel.createEnemyBullets(_v0) : _L.fromArray([]);
      }();
   });
   var spawnEnemyBatch = F4(function (seeds,
   spawnCooldown,
   player,
   enemies) {
      return function () {
         var formation = A2($GameEnemies.squareFormation,
         3,
         40);
         var dir = {_: {}
                   ,x: $Pseudorandom.get(seeds.c)($Pseudorandom.$float) - $Pseudorandom.get(seeds.a)($Pseudorandom.$float)
                   ,y: $Pseudorandom.get(seeds.d)($Pseudorandom.$float) - $Pseudorandom.get(seeds.b)($Pseudorandom.$float)};
         var pos = {_: {}
                   ,x: player.pos.x + 100 * $Basics.toFloat($Pseudorandom.get(seeds.a)($Pseudorandom.range({ctor: "_Tuple2"
                                                                                                           ,_0: -3
                                                                                                           ,_1: 3})))
                   ,y: player.pos.y + 100 * $Basics.toFloat($Pseudorandom.get(seeds.b)($Pseudorandom.range({ctor: "_Tuple2"
                                                                                                           ,_0: -3
                                                                                                           ,_1: 3})))};
         return _U.cmp(spawnCooldown,
         0) < 1 ? _L.append(A3($GameModel.createEnemyBatch,
         formation,
         pos,
         dir),
         enemies) : enemies;
      }();
   });
   var isActorKilled = function (actor) {
      return actor.kill;
   };
   var stepPlayerSpriteLivesSides = function (player) {
      return _U.eq(player.lives + 2,
      player.spr.sides) ? player : _U.replace([["spr"
                                               ,$GameDraw.playerSides(player.lives + 2)]],
      player);
   };
   var reloadGun = F2(function (t,
   gun) {
      return function () {
         var timeSince$ = gun.timeSince + t;
         return _U.replace([["timeSince"
                            ,timeSince$]],
         gun);
      }();
   });
   var fireGun = function (gun) {
      return _U.replace([["timeSince"
                         ,0]],
      gun);
   };
   var stepGun = F2(function (t,
   _v2) {
      return function () {
         return _U.cmp(_v2.gun.timeSince,
         1 / _v2.gun.fireRate) > 0 ? _U.replace([["gun"
                                                 ,fireGun(_v2.gun)]],
         _v2) : _U.replace([["gun"
                            ,A2(reloadGun,t,_v2.gun)]],
         _v2);
      }();
   });
   var stepPlayerGun = F3(function (t,
   fire,
   _v4) {
      return function () {
         return function () {
            var gun$ = _U.replace([["firing"
                                   ,fire]],
            _v4.gun);
            return fire ? A2(stepGun,
            t,
            _U.replace([["gun",gun$]],
            _v4)) : _U.replace([["gun"
                                ,gun$]],
            _v4);
         }();
      }();
   });
   var stepActorLivesCooldown = F2(function (t,
   _v6) {
      return function () {
         return _U.cmp(_v6.loseLifeCooldown,
         0) < 1 ? _U.replace([["loseLifeCooldown"
                              ,0]],
         _v6) : _U.replace([["loseLifeCooldown"
                            ,_v6.loseLifeCooldown - t]],
         _v6);
      }();
   });
   var accelerate = F5(function (t,
   accel,
   speed,
   dir,
   vel) {
      return A3($Basics.clamp,
      0 - speed,
      speed,
      vel + accel * dir);
   });
   var movePos = F3(function (t,
   pos,
   vel) {
      return {_: {}
             ,x: A3($Basics.clamp,
             0 - $GameModel.halfWidth,
             $GameModel.halfWidth,
             pos.x + vel.vx * t)
             ,y: A3($Basics.clamp,
             0 - $GameModel.halfHeight,
             $GameModel.halfHeight,
             pos.y + vel.vy * t)};
   });
   var actorPosition = F2(function (t,
   actor) {
      return A3(movePos,
      t,
      actor.pos,
      actor.vel);
   });
   var unitVector = function (pos) {
      return function () {
         var m = $Basics.sqrt(Math.pow(pos.x,
         2) + Math.pow(pos.y,2));
         return _U.replace([["x"
                            ,pos.x / m]
                           ,["y",pos.y / m]],
         pos);
      }();
   };
   var unitVectorTwoPoints = F2(function (pos,
   pos$) {
      return function () {
         var v = {_: {}
                 ,x: pos.x - pos$.x
                 ,y: pos.y - pos$.y};
         return unitVector(v);
      }();
   });
   var dist = F2(function (pos,
   pos$) {
      return $Basics.sqrt(Math.pow(pos.x - pos$.x,
      2) + Math.pow(pos.y - pos$.y,
      2));
   });
   var collides = F2(function (actor,
   actor$) {
      return _U.cmp(A2(dist,
      actor.pos,
      actor$.pos),
      $Basics.toFloat(actor.spr.size) + $Basics.toFloat(actor$.spr.size)) < 0 ? true : false;
   });
   var isFalse = function (val) {
      return val ? false : true;
   };
   var isTrue = function (val) {
      return val ? true : false;
   };
   var collider = F2(function (collideActors,
   actor) {
      return function () {
         var len = $List.length(A2($List.filter,
         isTrue,
         A2($List.map,
         function (ca) {
            return A2(collides,ca,actor);
         },
         collideActors)));
         return _U.cmp(len,
         0) > 0 ? true : false;
      }();
   });
   var stepActorLives = F3(function (t,
   bullets,
   actor) {
      return function () {
         var bulletsCollider = collider(bullets);
         return bulletsCollider(actor) ? _U.replace([["lives"
                                                     ,actor.lives - 1]
                                                    ,["loseLifeCooldown"
                                                     ,actor.loseLifeCooldownMax]],
         actor) : actor;
      }();
   });
   var stepActorLivesWithCooldown = F3(function (t,
   bullets,
   actor) {
      return _U.cmp(actor.loseLifeCooldown,
      0) < 1 ? A3(stepActorLives,
      t,
      bullets,
      actor) : actor;
   });
   var killEnemy = F2(function (playerBullets,
   enemy) {
      return collider(playerBullets)(enemy) ? _U.replace([["kill"
                                                          ,true]],
      enemy) : enemy;
   });
   var outside = F3(function (value,
   compare,
   offset) {
      return _U.cmp(value,
      compare - offset) < 1 || _U.cmp(value,
      compare + offset) > -1;
   });
   var avoidEdgesActor = F2(function (t,
   _v8) {
      return function () {
         return function () {
            var flipPosY = _U.replace([["y"
                                       ,0]],
            _v8.pos);
            var flipPosX = _U.replace([["x"
                                       ,0]],
            _v8.pos);
            var flipDirY = _U.replace([["y"
                                       ,0 - _v8.dir.y]],
            _v8.dir);
            var flipDirX = _U.replace([["x"
                                       ,0 - _v8.dir.x]],
            _v8.dir);
            return A3(outside,
            _v8.pos.x,
            0,
            $GameModel.halfWidth - 10) ? _U.replace([["pos"
                                                     ,flipPosX]],
            _v8) : A3(outside,
            _v8.pos.y,
            0,
            $GameModel.halfHeight - 10) ? _U.replace([["pos"
                                                      ,flipPosY]],
            _v8) : _v8;
         }();
      }();
   });
   var near = F3(function (value,
   compare,
   offset) {
      return _U.cmp(value,
      compare - offset) > -1 && _U.cmp(value,
      compare + offset) < 1;
   });
   var onCanvas = function (_v10) {
      return function () {
         return A3(near,
         _v10.pos.x,
         0,
         $GameModel.halfWidth - 1) && A3(near,
         _v10.pos.y,
         0,
         $GameModel.halfHeight - 1);
      }();
   };
   var tendToClose = F4(function (current,
   target,
   step,
   give) {
      return _U.cmp(current,
      target - give) > 0 ? current - step : _U.cmp(current,
      target + give) < 0 ? current + step : target;
   });
   var tendTo = F3(function (current,
   target,
   step) {
      return _U.cmp(current,
      target) > 0 ? current - step : _U.cmp(current,
      target) < 0 ? current + step : target;
   });
   var actorVelocity = F3(function (t,
   dir,
   _v12) {
      return function () {
         return {_: {}
                ,vx: _U.eq(dir.x,0) ? A3(tendTo,
                _v12.vel.vx,
                0,
                _v12.deccel) : A5(accelerate,
                t,
                _v12.accel,
                _v12.speed,
                dir.x,
                _v12.vel.vx)
                ,vy: _U.eq(dir.y,0) ? A3(tendTo,
                _v12.vel.vy,
                0,
                _v12.deccel) : A5(accelerate,
                t,
                _v12.accel,
                _v12.speed,
                dir.y,
                _v12.vel.vy)};
      }();
   });
   var moveActor = F3(function (t,
   dir,
   actor) {
      return function () {
         var vel$ = A3(actorVelocity,
         t,
         dir,
         actor);
         var pos$ = A2(actorPosition,
         t,
         actor);
         return _U.replace([["pos",pos$]
                           ,["vel",vel$]],
         actor);
      }();
   });
   var actorRotationalVelocity = F3(function (t,
   dir,
   _v14) {
      return function () {
         return _U.eq(dir.x,
         0) ? A3(tendTo,
         _v14.rot.vel,
         0,
         _v14.rot.deccel) : A5(accelerate,
         t,
         _v14.rot.accel,
         _v14.rot.speed,
         0 - dir.x,
         _v14.rot.vel);
      }();
   });
   var actorAngle = F3(function (t,
   dir,
   _v16) {
      return function () {
         return function () {
            var rotVel = A3(actorRotationalVelocity,
            t,
            dir,
            _v16);
            return _v16.rot.angle + rotVel;
         }();
      }();
   });
   var rotateActor = F3(function (t,
   dir,
   _v18) {
      return function () {
         return function () {
            var rot$ = _U.replace([["angle"
                                   ,A3(actorAngle,t,dir,_v18)]],
            _v18.rot);
            return _U.replace([["rot"
                               ,rot$]],
            _v18);
         }();
      }();
   });
   var stepBullets = F2(function (t,
   bullets) {
      return $List.filter(onCanvas)($List.map(function (bullet) {
         return A2(rotateActor,
         t,
         {_: {},x: 0,y: 0})(A2(moveActor,
         t,
         {_: {},x: 0,y: 0})(bullet));
      })(bullets));
   });
   var stepPlayerBullets = F4(function (t,
   input,
   _v20,
   bullets) {
      return function () {
         return F2(function (x,y) {
            return _L.append(x,y);
         })(_v20.gun.firing && _U.eq(_v20.gun.timeSince,
         0) ? $GameModel.createPlayerBullets(_v20) : _L.fromArray([]))(stepBullets(t)(bullets));
      }();
   });
   var stepEnemyBullets = F3(function (t,
   enemies,
   bullets) {
      return F2(function (x,y) {
         return _L.append(x,y);
      })($List.concatMap(function (enemy) {
         return fireEnemyBullets(t)(enemy);
      })(enemies))(stepBullets(t)(bullets));
   });
   var stepPlayer = F5(function (t,
   _v22,
   enemyBullets,
   score,
   player) {
      return function () {
         return function () {
            var rot$ = {_: {}
                       ,x: $Basics.toFloat(_v22.rot)
                       ,y: 0};
            var dir$ = _U.replace([["x"
                                   ,$Basics.toFloat(_v22.dir.x)]
                                  ,["y"
                                   ,$Basics.toFloat(_v22.dir.y)]],
            _v22.dir);
            return stepPlayerSpriteLivesSides(A2(stepActorLivesWithCooldown,
            t,
            enemyBullets)(stepActorLivesCooldown(t)(A2(stepPlayerGun,
            t,
            _v22.fire1)(A2(rotateActor,
            t,
            rot$)(A2(moveActor,
            t,
            dir$)(player))))));
         }();
      }();
   });
   var stepEnemy = F4(function (t,
   player,
   playerBullets,
   enemy) {
      return function () {
         var dir = A2(unitVectorTwoPoints,
         player.pos,
         enemy.pos);
         return killEnemy(playerBullets)(stepGun(t)(A2(rotateActor,
         t,
         enemy.dir)(A2(moveActor,
         t,
         enemy.dir)(avoidEdgesActor(t)(enemy)))));
      }();
   });
   var stepEnemies = F6(function (t,
   seeds,
   player,
   playerBullets,
   spawnCooldown,
   enemies) {
      return $List.map(function (enemy) {
         return A3(stepEnemy,
         t,
         player,
         playerBullets)(enemy);
      })(A3(spawnEnemyBatch,
      seeds,
      spawnCooldown,
      player)($List.filter(function ($) {
         return $Basics.not(isActorKilled($));
      })(enemies)));
   });
   var stepGame = F2(function (_v24,
   _v25) {
      return function () {
         return function () {
            return _U.eq(_v25.state,
            $GameModel.Pause) && _v24.userInput.unpause ? _U.replace([["state"
                                                                      ,$GameModel.Play]],
            _v25) : _U.eq(_v25.state,
            $GameModel.Pause) ? _v25 : _U.eq(_v25.state,
            $GameModel.Lost) ? _v25 : _U.cmp(_v25.player.lives,
            0) < 1 ? _U.replace([["state"
                                 ,$GameModel.Lost]],
            _v25) : function () {
               var seeds$ = {_: {}
                            ,a: A2($Pseudorandom.get,
                            _v25.seeds.a,
                            $Pseudorandom.$int)
                            ,b: A2($Pseudorandom.get,
                            _v25.seeds.b,
                            $Pseudorandom.$int)
                            ,c: A2($Pseudorandom.get,
                            _v25.seeds.c,
                            $Pseudorandom.$int)
                            ,d: A2($Pseudorandom.get,
                            _v25.seeds.d,
                            $Pseudorandom.$int)};
               var ui$ = A2(stepUI,
               _v24.timeDelta,
               _v25.player)(_v25.ui);
               var spawnCooldown$ = A2(stepSpawnCooldown,
               _v24.timeDelta,
               _v25.score)(_v25.spawnCooldown);
               var score$ = A2(stepScore,
               _v24.timeDelta,
               _v25.enemies)(_v25.score);
               var enemyBullets$ = A2(stepEnemyBullets,
               _v24.timeDelta,
               _v25.enemies)(_v25.enemyBullets);
               var enemies$ = A5(stepEnemies,
               _v24.timeDelta,
               _v25.seeds,
               _v25.player,
               _v25.playerBullets,
               _v25.spawnCooldown)(_v25.enemies);
               var playerBullets$ = A3(stepPlayerBullets,
               _v24.timeDelta,
               _v24.userInput,
               _v25.player)(_v25.playerBullets);
               var player$ = A4(stepPlayer,
               _v24.timeDelta,
               _v24.userInput,
               _v25.enemyBullets,
               _v25.score)(_v25.player);
               return _U.replace([["player"
                                  ,player$]
                                 ,["playerBullets"
                                  ,playerBullets$]
                                 ,["enemies",enemies$]
                                 ,["enemyBullets",enemyBullets$]
                                 ,["score",score$]
                                 ,["spawnCooldown"
                                  ,spawnCooldown$]
                                 ,["ui",ui$]
                                 ,["seeds",seeds$]],
               _v25);
            }();
         }();
      }();
   });
   _elm.GameUpdates.values = {_op: _op
                             ,tendTo: tendTo
                             ,tendToClose: tendToClose
                             ,near: near
                             ,outside: outside
                             ,isTrue: isTrue
                             ,isFalse: isFalse
                             ,onCanvas: onCanvas
                             ,dist: dist
                             ,unitVector: unitVector
                             ,unitVectorTwoPoints: unitVectorTwoPoints
                             ,collides: collides
                             ,collider: collider
                             ,movePos: movePos
                             ,accelerate: accelerate
                             ,actorPosition: actorPosition
                             ,actorVelocity: actorVelocity
                             ,actorRotationalVelocity: actorRotationalVelocity
                             ,actorAngle: actorAngle
                             ,moveActor: moveActor
                             ,rotateActor: rotateActor
                             ,stepActorLives: stepActorLives
                             ,stepActorLivesCooldown: stepActorLivesCooldown
                             ,stepActorLivesWithCooldown: stepActorLivesWithCooldown
                             ,fireGun: fireGun
                             ,reloadGun: reloadGun
                             ,stepGun: stepGun
                             ,stepBullets: stepBullets
                             ,stepPlayerGun: stepPlayerGun
                             ,stepPlayerSpriteLivesSides: stepPlayerSpriteLivesSides
                             ,stepPlayer: stepPlayer
                             ,stepPlayerBullets: stepPlayerBullets
                             ,killEnemy: killEnemy
                             ,avoidEdgesActor: avoidEdgesActor
                             ,stepEnemy: stepEnemy
                             ,isActorKilled: isActorKilled
                             ,spawnEnemyBatch: spawnEnemyBatch
                             ,stepEnemies: stepEnemies
                             ,fireEnemyBullets: fireEnemyBullets
                             ,stepEnemyBullets: stepEnemyBullets
                             ,addScoreForKill: addScoreForKill
                             ,stepScore: stepScore
                             ,stepSpawnCooldown: stepSpawnCooldown
                             ,stepUI: stepUI
                             ,stepGame: stepGame};
   return _elm.GameUpdates.values;
};</script></head><body><script type="text/javascript">Elm.fullscreen(Elm.GameUpdates)</script><noscript></noscript></body></html>